import{P as u}from"./PicoView-iUxXwDXZ.js";import{A as i}from"./AppRequest-BdPYhK6t.js";import{a as d,G as l}from"./Grid-7GupHutO.js";import{p}from"./domHelpers-0caSGQTr.js";let c;document.addEventListener("DOMContentLoaded",async()=>{const s=new m;s.init();const o=document.getElementById("container");c=new u(o),t(c,s);function t(n,e){const a={"photo.more":r=>e.showMore(),"photo.info":r=>e.viewInfo(r.detail.id),"photo.download":r=>e.forceDownload(r.detail.id)};for(const[r,h]of Object.entries(a))n.addEventListener(r,h)}});class m{constructor(o="container"){this.container=document.getElementById(o),this.currentDate=null,this.photoGroups={},this.container=document.getElementById("container"),this.scrollSpy=new bootstrap.ScrollSpy(document.body,{target:"#dummy-nav"});const t=document.getElementById("currentSectionLabel");document.body.addEventListener("activate.bs.scrollspy",n=>{const e=document.querySelector("#dummy-nav a.active");e&&(t.textContent=e.textContent.trim())}),this.loader=new g,this.sleep=n=>new Promise(e=>setTimeout(e,n))}async init(){await this.showMore()}async showMore(){this.loader.hasNextPage()&&((await this.loader.next()).forEach(t=>{this.photoGroups[t.taken_day_desc]||(this.photoGroups[t.taken_day_desc]=[]),this.photoGroups[t.taken_day_desc].push(t)}),this.addPhotoGroup())}addPhotoGroup(){const o=Object.entries(this.photoGroups);if(!o.length)return;const[t,n]=o[0];if(delete this.photoGroups[t],this.currentDate!==t){this.currentDate=t,this.container.append(d.separator(t,this));const e=this.createGrid(`img_${n[0].id}`);this.grid=new l(this,e),e.addEventListener("grid.render.added",()=>{c.refresh()}),e.addEventListener("grid.render.done",()=>{this.scrollSpy.refresh(),this.addPhotoGroup()});const a=document.getElementById("dummy-nav"),r=document.createElement("a");r.href=`#img_${n[0].id}`,r.textContent=n[0].taken_age,a.appendChild(r)}n.forEach(async e=>{this.grid.add(await d.photo(e,!1),o.length==1)})}createGrid(o=""){const t=document.createElement("div");t.className="grid row w-100 no-gutters",o&&(t.id=o),this.container.appendChild(t);const n=document.createElement("div");n.className="grid-sizer",t.appendChild(n);const e=document.createElement("div");return e.className="gutter-sizer",t.appendChild(e),this.grid=t,this.masonry=new Masonry(this.grid,{itemSelector:".grid-item",columnWidth:".grid-sizer",transitionDuration:"0.4s",percentPosition:!0}),t}async viewInfo(o){try{const e=route("api.photos.show",{photo:o}),a=await i.request(e,"GET");p(document.getElementById("infoForm"),{dimensions:`${a.data.width} x ${a.data.height}`,...a.data})}catch(e){console.error(e)}const t=document.getElementById("offcanvas-info");bootstrap.Offcanvas.getOrCreateInstance(t).show()}forceDownload(o){const t=route("photos.download",{photo:o});window.location.href=t}}class g{constructor(){this.lastPage=null,this.currentPage=0}async start(){return this.currentPage=0,await this.next()}hasNextPage(){return this.lastPage==null||this.currentPage<this.lastPage}async next(){return this.hasNextPage()?await this._fetchPage(this.currentPage+1):[]}async _fetchPage(o=1){if(i.isLoading("photos"))return[];try{const t=await i.request(`/api/photos?page=${o}`,"GET",null,"photos");return this.currentPage=t.meta.current_page,this.lastPage=t.meta.last_page,t.data}catch(t){console.error(t)}return[]}}
