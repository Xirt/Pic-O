import{A as m}from"./AppRequest-BdPYhK6t.js";const h=(function(){const i=document.querySelector(".progress-container"),a={},l={};let e=null,t=!1,s=!1,n=null;function d(){i.querySelectorAll(".job-progress").forEach(r=>{const o=r.dataset.jobType;o&&(l[o]={jobWrapper:r,countEl:r.querySelector(".job-count"),barEl:r.querySelector(".progress-bar")},a[o]=0)})}async function u(){if(!s){s=!0;try{const c=await m.request(route("api.jobs.count"),"GET",null,null,!1),r={};for(const o of c)r[o.type]=o.count,(!a[o.type]||o.count>a[o.type])&&(a[o.type]=o.count);g(r)}catch(c){console.log(c)}s=!1}}function g(c){let r=!1;for(const o in l){const{jobWrapper:L,countEl:v,barEl:b}=l[o],y=c[o]||0,p=a[o]||1,I=1-y/p,E=Math.min(Math.max(I,0),1);b.style.width=`${(E*100).toFixed(0)}%`,v.textContent=p-y+"/"+p+" ("+Math.round(E*100)+"%)",r=y==0?r:!0}i.classList.toggle("visible",r),n&&n(r)}return{start:function(c){t||(d(),t=!0,e=setInterval(u,1e3),n=c||null,u())},stop:function(){if(t){clearInterval(e),e=null,t=!1;for(const c in a)a[c]=0;g({})}},isRunning:function(){return t}}})();document.addEventListener("DOMContentLoaded",()=>{let f;const i=document.getElementById("scanButton");i.addEventListener("click",async e=>{e.preventDefault();try{const t=await m.request(route("api.jobs.dispatch"),"POST",{type:"TraverseFolderJob"})}catch(t){console.log(t)}}),h.start(e=>{i.disabled=e});const a=document.getElementById("createForm");a.addEventListener("submit",async e=>{e.preventDefault();try{const t=new FormData(a),s=Object.fromEntries(t.entries()),n=await m.request(a.action,"POST",s);l(document.getElementById("createFormMessage"),n.message,!0),setTimeout(()=>{window.location.href=window.location.href},1e3)}catch(t){const s=t?.response?.message||t?.message||"An unknown error occurred.";l(document.getElementById("createFormMessage"),s,!1)}}),document.querySelectorAll('button[data-bs-target="#offcanvas-modify-user"]').forEach(e=>{e.addEventListener("click",async function(){const t=this.getAttribute("data-user-id");try{const n=(await m.request(`/api/users/${t}`,"GET")).data;document.getElementById("modifyUserId").value=n.id,document.getElementById("modifyUserName").value=n.name,document.getElementById("modifyUserEmail").value=n.email,document.getElementById("modifyUserRole").value=n.role;const d=document.getElementById("offcanvas-modify-user");bootstrap.Offcanvas.getOrCreateInstance(d).show()}catch(s){alert("Failed to load user data: "+s.message)}})}),document.getElementById("modifyForm").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("modifyUserId").value,s=this,n=`/api/users/${t}`,d={name:s.name.value,email:s.email.value,role:s.role.value};document.getElementById("modifyFormMessage");try{const u=await m.request(n,"PUT",d);location.reload()}catch(u){const g=u?.response?.message||u?.message||"An unknown error occurred.";l(document.getElementById("modifyFormMessage"),g,!1)}});function l(e,t,s=!0){e.classList.add("visible"),e.classList.toggle("alert-success",s),e.classList.toggle("alert-warning",!s),e.textContent=t,f&&clearTimeout(f),f=setTimeout(()=>{e.classList.remove("visible")},3e3)}});
