import{P as u}from"./PicoView-iUxXwDXZ.js";import{A as i}from"./AppRequest-BAjaqpDZ.js";import{a as c,G as l}from"./Grid-B13L45IR.js";import{p}from"./domHelpers-0caSGQTr.js";let d;document.addEventListener("DOMContentLoaded",async()=>{const s=new m;s.init();const e=document.getElementById("container");d=new u(e),t(d,s);function t(n,o){const r={"photo.more":a=>o.showMore(),"photo.info":a=>o.viewInfo(a.detail.id),"photo.download":a=>o.forceDownload(a.detail.id)};for(const[a,h]of Object.entries(r))n.addEventListener(a,h)}});class m{constructor(e="container"){this.container=document.getElementById(e),this.currentDate=null,this.photoGroups={},this.container=document.getElementById("container"),this.scrollSpy=new bootstrap.ScrollSpy(document.body,{target:"#dummy-nav"});const t=document.getElementById("currentSectionLabel");document.body.addEventListener("activate.bs.scrollspy",n=>{const o=document.querySelector("#dummy-nav a.active");o&&(t.textContent=o.textContent.trim())}),this.loader=new g,this.sleep=n=>new Promise(o=>setTimeout(o,n))}async init(){await this.showMore()}async showMore(){this.loader.hasNextPage()&&((await this.loader.next()).forEach(t=>{this.photoGroups[t.taken_date]||(this.photoGroups[t.taken_date]=[]),this.photoGroups[t.taken_date].push(t)}),this.addPhotoGroup())}async addPhotoGroup(){const e=Object.entries(this.photoGroups);if(!e.length)return;const[t,n]=e[0];if(delete this.photoGroups[t],this.currentDate!==t){this.currentDate=t,this.container.append(c.separator(t,this));const o=this.createGrid(`img_${n[0].id}`);this.grid=new l(this,o),o.addEventListener("grid.render.added",()=>{d.refresh()}),o.addEventListener("grid.render.done",()=>{this.scrollSpy.refresh(),this.addPhotoGroup()});const r=document.getElementById("dummy-nav"),a=document.createElement("a");a.href=`#img_${n[0].id}`,a.textContent=n[0].taken_age,r.appendChild(a)}await this.addPhotoGroupPhotos(n,e.length==1)}async addPhotoGroupPhotos(e,t){for(const n of[...e]){const o=await c.photo(n,!1);this.grid.add(o,t);const r=e.indexOf(n);r>-1&&e.splice(r,1)}}createGrid(e=""){const t=document.createElement("div");t.className="grid row w-100 no-gutters",e&&(t.id=e),this.container.appendChild(t);const n=document.createElement("div");n.className="grid-sizer",t.appendChild(n);const o=document.createElement("div");return o.className="gutter-sizer",t.appendChild(o),this.grid=t,this.masonry=new Masonry(this.grid,{itemSelector:".grid-item",columnWidth:".grid-sizer",transitionDuration:"0.4s",percentPosition:!0}),t}async viewInfo(e){try{const o=route("api.photos.show",{photo:e}),r=await i.request(o,"GET");p(document.getElementById("infoForm"),{dimensions:`${r.data.width} x ${r.data.height}`,...r.data})}catch(o){console.error(o)}const t=document.getElementById("offcanvas-info");bootstrap.Offcanvas.getOrCreateInstance(t).show()}forceDownload(e){const t=route("photos.download",{photo:e});window.location.href=t}}class g{constructor(){this.lastPage=null,this.currentPage=0}async start(){return this.currentPage=0,await this.next()}hasNextPage(){return this.lastPage==null||this.currentPage<this.lastPage}async next(){return this.hasNextPage()?await this._fetchPage(this.currentPage+1):[]}async _fetchPage(e=1){if(i.isLoading("photos"))return[];try{const t=await i.request(`/api/photos?page=${e}`,"GET",null,"photos");return this.currentPage=t.meta.current_page,this.lastPage=t.meta.last_page,t.data}catch(t){console.error(t)}return[]}}
