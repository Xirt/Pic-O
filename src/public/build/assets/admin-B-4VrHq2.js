import{A as d}from"./AppRequest-D0B9dxYA.js";const v=(function(){const i=document.querySelector(".progress-container"),a={},l={};let t=null,e=!1;function o(){i.querySelectorAll(".job-progress").forEach(r=>{const s=r.dataset.jobType;s&&(l[s]={jobWrapper:r,countEl:r.querySelector(".job-count"),barEl:r.querySelector(".progress-bar")},a[s]=0)})}async function c(){try{const n=await d.request(route("api.jobs.count"),"GET"),r={};for(const s of n)r[s.type]=s.count,(!a[s.type]||s.count>a[s.type])&&(a[s.type]=s.count);u(r)}catch(n){console.log(n)}}function u(n){let r=!1;for(const s in l){const{jobWrapper:I,countEl:y,barEl:g}=l[s],f=n[s]||0,p=a[s]||1,E=1-f/p,b=Math.min(Math.max(E,0),1);g.style.width=`${(b*100).toFixed(0)}%`,y.textContent=f,r=f==0?r:!0}i.classList.toggle("visible",r)}return{start:function(){e||(o(),e=!0,c(),t=setInterval(c,1e3))},stop:function(){if(e){clearInterval(t),t=null,e=!1;for(const n in a)a[n]=0;u({})}},isRunning:function(){return e}}})();document.addEventListener("DOMContentLoaded",()=>{let m;v.start();const i=document.getElementById("scanButton");i.addEventListener("click",async t=>{t.preventDefault();try{i.disabled=!0;const e=await d.request(route("api.jobs.dispatch"),"POST",{type:"TraverseFolderJob"})}catch(e){console.log(e)}});const a=document.getElementById("createForm");a.addEventListener("submit",async t=>{t.preventDefault();try{const e=new FormData(a),o=Object.fromEntries(e.entries()),c=await d.request(a.action,"POST",o);l(document.getElementById("createFormMessage"),c.message,!0),setTimeout(()=>{window.location.href=window.location.href},1e3)}catch(e){const o=e?.response?.message||e?.message||"An unknown error occurred.";l(document.getElementById("createFormMessage"),o,!1)}}),document.querySelectorAll('button[data-bs-target="#offcanvas-modify-user"]').forEach(t=>{t.addEventListener("click",async function(){const e=this.getAttribute("data-user-id");try{const c=(await d.request(`/api/users/${e}`,"GET")).data;document.getElementById("modifyUserId").value=c.id,document.getElementById("modifyUserName").value=c.name,document.getElementById("modifyUserEmail").value=c.email,document.getElementById("modifyUserRole").value=c.role;const u=document.getElementById("offcanvas-modify-user");bootstrap.Offcanvas.getOrCreateInstance(u).show()}catch(o){alert("Failed to load user data: "+o.message)}})}),document.getElementById("modifyForm").addEventListener("submit",async function(t){t.preventDefault();const e=document.getElementById("modifyUserId").value,o=this,c=`/api/users/${e}`,u={name:o.name.value,email:o.email.value,role:o.role.value};document.getElementById("modifyFormMessage");try{const n=await d.request(c,"PUT",u);location.reload()}catch(n){const r=n?.response?.message||n?.message||"An unknown error occurred.";l(document.getElementById("modifyFormMessage"),r,!1)}});function l(t,e,o=!0){t.classList.add("visible"),t.classList.toggle("alert-success",o),t.classList.toggle("alert-warning",!o),t.textContent=e,m&&clearTimeout(m),m=setTimeout(()=>{t.classList.remove("visible")},3e3)}});
