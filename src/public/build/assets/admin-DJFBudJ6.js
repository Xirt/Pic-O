import{A as m}from"./AppRequest-D0B9dxYA.js";const I=(function(){const d=document.querySelector(".progress-container"),n={},l={};let t=null,e=!1,o=!1;function a(){d.querySelectorAll(".job-progress").forEach(r=>{const s=r.dataset.jobType;s&&(l[s]={jobWrapper:r,countEl:r.querySelector(".job-count"),barEl:r.querySelector(".progress-bar")},n[s]=0)})}async function i(){if(!o){o=!0;try{const c=await m.request(route("api.jobs.count"),"GET"),r={};for(const s of c)r[s.type]=s.count,(!n[s.type]||s.count>n[s.type])&&(n[s.type]=s.count);u(r)}catch(c){console.log(c)}o=!1}}function u(c){let r=!1;for(const s in l){const{jobWrapper:h,countEl:g,barEl:p}=l[s],y=c[s]||0,E=n[s]||1,v=1-y/E,b=Math.min(Math.max(v,0),1);p.style.width=`${(b*100).toFixed(0)}%`,g.textContent=y,r=y==0?r:!0}d.classList.toggle("visible",r)}return{start:function(){e||(a(),e=!0,t=setInterval(i,1e3),i())},stop:function(){if(e){clearInterval(t),t=null,e=!1;for(const c in n)n[c]=0;u({})}},isRunning:function(){return e}}})();document.addEventListener("DOMContentLoaded",()=>{let f;I.start();const d=document.getElementById("scanButton");d.addEventListener("click",async t=>{t.preventDefault();try{d.disabled=!0;const e=await m.request(route("api.jobs.dispatch"),"POST",{type:"TraverseFolderJob"})}catch(e){console.log(e)}});const n=document.getElementById("createForm");n.addEventListener("submit",async t=>{t.preventDefault();try{const e=new FormData(n),o=Object.fromEntries(e.entries()),a=await m.request(n.action,"POST",o);l(document.getElementById("createFormMessage"),a.message,!0),setTimeout(()=>{window.location.href=window.location.href},1e3)}catch(e){const o=e?.response?.message||e?.message||"An unknown error occurred.";l(document.getElementById("createFormMessage"),o,!1)}}),document.querySelectorAll('button[data-bs-target="#offcanvas-modify-user"]').forEach(t=>{t.addEventListener("click",async function(){const e=this.getAttribute("data-user-id");try{const a=(await m.request(`/api/users/${e}`,"GET")).data;document.getElementById("modifyUserId").value=a.id,document.getElementById("modifyUserName").value=a.name,document.getElementById("modifyUserEmail").value=a.email,document.getElementById("modifyUserRole").value=a.role;const i=document.getElementById("offcanvas-modify-user");bootstrap.Offcanvas.getOrCreateInstance(i).show()}catch(o){alert("Failed to load user data: "+o.message)}})}),document.getElementById("modifyForm").addEventListener("submit",async function(t){t.preventDefault();const e=document.getElementById("modifyUserId").value,o=this,a=`/api/users/${e}`,i={name:o.name.value,email:o.email.value,role:o.role.value};document.getElementById("modifyFormMessage");try{const u=await m.request(a,"PUT",i);location.reload()}catch(u){const c=u?.response?.message||u?.message||"An unknown error occurred.";l(document.getElementById("modifyFormMessage"),c,!1)}});function l(t,e,o=!0){t.classList.add("visible"),t.classList.toggle("alert-success",o),t.classList.toggle("alert-warning",!o),t.textContent=e,f&&clearTimeout(f),f=setTimeout(()=>{t.classList.remove("visible")},3e3)}});
