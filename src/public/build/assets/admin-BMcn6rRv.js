import{A as d}from"./AppRequest-BdPYhK6t.js";const h=(function(){const f=document.querySelector(".progress-container"),n={},u={};let l=null,e=!1,t=!1,s=null;function r(){f.querySelectorAll(".job-progress").forEach(c=>{const o=c.dataset.jobType;o&&(u[o]={jobWrapper:c,countEl:c.querySelector(".job-count"),barEl:c.querySelector(".progress-bar")},n[o]=0)})}async function m(){if(!t){t=!0;try{const a=await d.request(route("api.jobs.count"),"GET",null,null,!1),c={};for(const o of a)c[o.type]=o.count,(!n[o.type]||o.count>n[o.type])&&(n[o.type]=o.count);i(c)}catch(a){console.log(a)}t=!1}}function i(a){let c=!1;for(const o in u){const{jobWrapper:w,countEl:v,barEl:b}=u[o],y=a[o]||0,p=n[o]||1,I=1-y/p,E=Math.min(Math.max(I,0),1);b.style.width=`${(E*100).toFixed(0)}%`,v.textContent=p-y+"/"+p+" ("+Math.round(E*100)+"%)",c=y==0?c:!0}f.classList.toggle("visible",c),s&&s(c)}return{start:function(a){e||(r(),e=!0,l=setInterval(m,1e3),s=a||null,m())},stop:function(){if(e){clearInterval(l),l=null,e=!1;for(const a in n)n[a]=0;i({})}},isRunning:function(){return e}}})();document.addEventListener("DOMContentLoaded",()=>{let g;const f=document.getElementById("scanButton");f.addEventListener("click",async e=>{e.preventDefault();try{const t=await d.request(route("api.jobs.dispatch"),"POST",{type:"TraverseFolderJob"})}catch(t){console.log(t)}}),h.start(e=>{f.disabled=e});const n=document.getElementById("settingsForm");n.addEventListener("submit",async e=>{e.preventDefault();try{const t=new FormData(n),s=Object.fromEntries(t.entries()),r=await d.request(n.action,"POST",s);l(n.querySelector(".form-message"),r.message,!0)}catch(t){const s=t?.response?.message||t?.message||"An unknown error occurred.";l(n.querySelector(".form-message"),s,!1)}});const u=document.getElementById("createForm");u.addEventListener("submit",async e=>{e.preventDefault();try{const t=new FormData(u),s=Object.fromEntries(t.entries()),r=await d.request(u.action,"POST",s);l(document.getElementById("createFormMessage"),r.message,!0),setTimeout(()=>{window.location.href=window.location.href},1e3)}catch(t){const s=t?.response?.message||t?.message||"An unknown error occurred.";l(document.getElementById("createFormMessage"),s,!1)}}),document.querySelectorAll('button[data-bs-target="#offcanvas-modify-user"]').forEach(e=>{e.addEventListener("click",async function(){const t=this.getAttribute("data-user-id");try{const r=(await d.request(`/api/users/${t}`,"GET")).data;document.getElementById("modifyUserId").value=r.id,document.getElementById("modifyUserName").value=r.name,document.getElementById("modifyUserEmail").value=r.email,document.getElementById("modifyUserRole").value=r.role;const m=document.getElementById("offcanvas-modify-user");bootstrap.Offcanvas.getOrCreateInstance(m).show()}catch(s){alert("Failed to load user data: "+s.message)}})}),document.getElementById("modifyForm").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("modifyUserId").value,s=this,r=`/api/users/${t}`,m={name:s.name.value,email:s.email.value,role:s.role.value};document.getElementById("modifyFormMessage");try{const i=await d.request(r,"PUT",m);location.reload()}catch(i){const a=i?.response?.message||i?.message||"An unknown error occurred.";l(document.getElementById("modifyFormMessage"),a,!1)}});function l(e,t,s=!0){e.classList.add("visible"),e.classList.toggle("alert-success",s),e.classList.toggle("alert-warning",!s),e.textContent=t,g&&clearTimeout(g),g=setTimeout(()=>{e.classList.remove("visible")},3e3)}});
