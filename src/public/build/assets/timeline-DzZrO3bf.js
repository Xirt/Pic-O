import{a as d,G as l,M as u}from"./Grid-CwpxcxeZ.js";import{P as p}from"./PicoView-iUxXwDXZ.js";import{A as i}from"./AppRequest-BAjaqpDZ.js";import{p as m}from"./domHelpers-0caSGQTr.js";let c;document.addEventListener("DOMContentLoaded",async()=>{const r=new f;r.init();const e=document.getElementById("container");c=new p(e),t(c,r);function t(n,o){const a={"photo.more":s=>o.showMore(),"photo.info":s=>o.viewInfo(s.detail.id),"photo.download":s=>o.forceDownload(s.detail.id)};for(const[s,h]of Object.entries(a))n.addEventListener(s,h)}});class f{constructor(e="container"){this.container=document.getElementById(e),this.currentDate=null,this.photoGroups={},this.container=document.getElementById("container"),this.scrollSpy=new bootstrap.ScrollSpy(document.body,{target:"#dummy-nav"});const t=document.getElementById("currentSectionLabel");document.body.addEventListener("activate.bs.scrollspy",n=>{const o=document.querySelector("#dummy-nav a.active");o&&(t.textContent=o.textContent.trim())}),this.loader=new g,this.sleep=n=>new Promise(o=>setTimeout(o,n))}async init(){await this.showMore()}async showMore(){this.loader.hasNextPage()&&((await this.loader.next()).forEach(t=>{this.photoGroups[t.taken_date]||(this.photoGroups[t.taken_date]=[]),this.photoGroups[t.taken_date].push(t)}),this.addPhotoGroup())}async addPhotoGroup(){const e=Object.entries(this.photoGroups);if(!e.length)return;const[t,n]=e[0];if(delete this.photoGroups[t],this.currentDate!==t){this.currentDate=t,this.container.append(d.separator(t,this));const o=this.createGrid(`img_${n[0].id}`);this.grid=new l(this,o),o.addEventListener("grid.render.added",()=>{c.refresh()}),o.addEventListener("grid.render.done",()=>{this.scrollSpy.refresh(),this.addPhotoGroup()});const a=document.getElementById("dummy-nav"),s=document.createElement("a");s.href=`#img_${n[0].id}`,s.textContent=n[0].taken_age,a.appendChild(s)}await this.addPhotoGroupPhotos(n,e.length==1)}async addPhotoGroupPhotos(e,t){for(const n of[...e]){const o=await d.photo(n,!1);this.grid.add(o,t);const a=e.indexOf(n);a>-1&&e.splice(a,1)}}createGrid(e=""){const t=document.createElement("div");return t.dataset.cols="sm:3 lg:6",t.className="grid row w-100 g-0",this.container.appendChild(t),e&&(t.id=e),this.grid=t,this.masonry=new u(this.grid),t}async viewInfo(e){try{const o=route("api.photos.show",{photo:e}),a=await i.request(o,"GET");m(document.getElementById("infoForm"),{dimensions:`${a.data.width} x ${a.data.height}`,...a.data})}catch(o){console.error(o)}const t=document.getElementById("offcanvas-info");bootstrap.Offcanvas.getOrCreateInstance(t).show()}forceDownload(e){const t=route("photos.download",{photo:e});window.location.href=t}}class g{constructor(){this.lastPage=null,this.currentPage=0}async start(){return this.currentPage=0,await this.next()}hasNextPage(){return this.lastPage==null||this.currentPage<this.lastPage}async next(){return this.hasNextPage()?await this._fetchPage(this.currentPage+1):[]}async _fetchPage(e=1){if(i.isLoading("photos"))return[];try{const t=await i.request(`/api/photos?page=${e}`,"GET",null,"photos");return this.currentPage=t.meta.current_page,this.lastPage=t.meta.last_page,t.data}catch(t){console.error(t)}return[]}}
