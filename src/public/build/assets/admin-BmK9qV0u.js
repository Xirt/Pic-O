import{A as d,t as v,o as L,r as h}from"./domHelpers-Da9rvIEx.js";const I=(function(){const m=document.querySelector(".progress-container");let n={};const i={};let l=null,e=!1,t=!1,s=null;function r(){m.querySelectorAll(".job-progress").forEach(o=>{const c=o.dataset.jobType;c&&(i[c]={jobWrapper:o,countEl:o.querySelector(".job-count"),upArrow:o.querySelector(".arrow-up"),downArrow:o.querySelector(".arrow-down")},n[c]=0)})}async function u(){if(!t){t=!0;try{const a=await d.request(route("api.jobs.count"),"GET",null,null,!1),o={};for(const c of a)o[c.type]=c.count;g(o,n),n=o}catch(a){console.log(a)}t=!1}}function g(a){let o=!1;for(const c in i){const{jobWrapper:q,countEl:b,upArrow:p,downArrow:E}=i[c],y=a[c]||0,w=n[c]||0;b.textContent=y,w<y&&(p.classList.add("show"),setTimeout(()=>{p.classList.remove("show")},500)),w>y&&(E.classList.add("show"),setTimeout(()=>{E.classList.remove("show")},500)),o=y==0?o:!0}m.classList.toggle("visible",o),s&&s(o)}return{start:function(a){e||(r(),e=!0,l=setInterval(u,1e3),s=a||null,u())},stop:function(){if(e){clearInterval(l),l=null,e=!1;for(const a in maxCounts)maxCounts[a]=0;g({})}},isRunning:function(){return e}}})();document.addEventListener("DOMContentLoaded",()=>{let f;const m=document.getElementById("scanButton");m.addEventListener("click",async e=>{e.preventDefault();try{const t=await d.request(route("api.jobs.dispatch"),"POST",{type:"TraverseFolderJob"});v("Scan requested")}catch(t){console.log(t)}}),I.start(e=>{m.disabled=e});const n=document.getElementById("settingsForm");n.addEventListener("submit",async e=>{e.preventDefault();try{const t=new FormData(n),s=Object.fromEntries(t.entries()),r=await d.request(n.action,"POST",s);l(n.querySelector(".form-message"),r.message,!0)}catch(t){const s=t?.response?.message||t?.message||"An unknown error occurred.";l(n.querySelector(".form-message"),s,!1)}});const i=document.getElementById("createForm");i.addEventListener("submit",async e=>{e.preventDefault();try{const t=new FormData(i),s=Object.fromEntries(t.entries()),r=await d.request(i.action,"POST",s);l(document.getElementById("createFormMessage"),r.message,!0),setTimeout(()=>{window.location.href=window.location.href},1e3)}catch(t){const s=t?.response?.message||t?.message||"An unknown error occurred.";l(document.getElementById("createFormMessage"),s,!1)}}),document.querySelectorAll('button[data-bs-target="#offcanvas-modify-user"]').forEach(e=>{e.addEventListener("click",async function(){const t=this.getAttribute("data-user-id");try{const r=(await d.request(`/api/users/${t}`,"GET")).data;document.getElementById("modifyUserId").value=r.id,document.getElementById("modifyUserName").value=r.name,document.getElementById("modifyUserEmail").value=r.email,document.getElementById("modifyUserRole").value=r.role;const u=document.getElementById("offcanvas-modify-user");bootstrap.Offcanvas.getOrCreateInstance(u).show()}catch(s){alert("Failed to load user data: "+s.message)}})}),document.querySelectorAll("button.remove-user").forEach(e=>{e.addEventListener("click",function(){const t=this.getAttribute("data-user-id"),s=L("offcanvasRemoveUser");let r=document.getElementById("userRemovalBtn");h(r).addEventListener("click",async()=>{try{const u=route("api.users.destroy",{user:t}),g=await d.request(u,"DELETE");document.querySelector(`tr[data-user-id="${t}"]`)?.remove(),v("User deleted")}catch(u){u.message&&v(u.message)}s.hide()})})});function l(e,t,s=!0){e.classList.add("visible"),e.classList.toggle("alert-success",s),e.classList.toggle("alert-warning",!s),e.textContent=t,f&&clearTimeout(f),f=setTimeout(()=>{e.classList.remove("visible")},3e3)}});
