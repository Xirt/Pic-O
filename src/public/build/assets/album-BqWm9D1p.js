import{P as w}from"./PicoView-iUxXwDXZ.js";import{S as y}from"./Selection-DBGP1SeL.js";import{A as l}from"./AppRequest-BdPYhK6t.js";import{G as E,a as P}from"./Grid-7GupHutO.js";import{t as m,b as v,p as I,o as B,r as L}from"./domHelpers-0caSGQTr.js";document.addEventListener("DOMContentLoaded",async()=>{const u=document.getElementById("grid"),n=document.getElementById("album").dataset.albumId;new y(u);const t=new x(n),r=new w(u);t.init(),p(r,t),b(u,r);const c=document.getElementById("generateTokenBtn");c.addEventListener("click",async function(i){i.preventDefault();try{const a=c.getAttribute("data-album-id"),e=await l.request(route("api.tokens.store"),"POST",{album_id:a});document.getElementById("tokenList").appendChild(s(e.data)),console.log(e)}catch(a){console.error(a)}});function s(i){const a=route("albums.show",{album:i.album_id,token:i.token}),e=document.createElement("div");e.className="d-flex mb-1";const o=document.createElement("input");o.className="flex-grow-1",o.value=a,o.className="form-control",e.appendChild(o);const d=document.createElement("button");d.type="button",d.className="btn btn-primary btn-sm mx-2 btn-copy",d.addEventListener("click",()=>{navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(a):(o.select(),document.execCommand("copy")),m("clipboardToast")});const f=v("copy");d.appendChild(f),e.appendChild(d);const h=document.createElement("button");h.className="btn btn-secondary btn-sm btn-calendar";const g=v("calendar3-event");return h.appendChild(g),e.appendChild(h),e}function p(i,a){const e={"photo.more":o=>a.showMore(),"photo.info":o=>a.viewInfo(o.detail.id),"photo.cover":o=>a.setCover(o.detail.id),"photo.download":o=>a.forceDownload(o.detail.id),"photo.remove":o=>{a.remove(o.detail.id),i.next()}};for(const[o,d]of Object.entries(e))i.addEventListener(o,d)}function b(i,a){Object.entries({"grid.refresh":o=>a.refresh(),"selection.start":o=>a.disable(),"selection.stop":o=>a.enable()}).forEach(([o,d])=>{i.addEventListener(o,d)})}});class x{constructor(n){this.id=n,this.grid=new E(this),this.loader=new C(n)}async init(){this.grid.clear(),await this.showMore()}async showMore(){if(this.loader.hasNextPage()){const t=(await this.loader.next()).map(async c=>{const s=await P.photo(c);return s.querySelector(".btn-delete").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.remove(c.id)}),s.querySelector(".btn-info").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.viewInfo(c.id)}),s.querySelector(".btn-cover").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.setCover(c.id)}),s.querySelector(".btn-download").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.forceDownload(c.id)}),s}),r=await Promise.all(t);this.grid.add(r)}}async viewInfo(n){try{const t=route("api.photos.show",{photo:n}),r=await l.request(t,"GET");I(document.getElementById("infoForm"),{dimensions:`${r.data.width} x ${r.data.height}`,...r.data})}catch(t){console.error(t)}B("offcanvas-info")}forceDownload(n){const t=route("photos.download",{photo:n});window.location.href=t}async setCover(n){try{const t=route("api.albums.update",{album:this.id});await l.request(t,"PATCH",{photo_id:n}),m("coverToast")}catch(t){console.error(t)}}async remove(n){const t=document.getElementById(`card-${n}`);try{const s=route("api.albums.photos.removeOne",{album:this.id,photo:n});await l.request(s,"DELETE")}catch(s){console.error(s)}const r=m("removalToast");this.grid.remove(t);const c=document.getElementById("btn-undo");L(c).addEventListener("click",async()=>{try{const s=route("api.albums.photos.addOne",{album:this.id,photo:n});await l.request(s,"PUT")}catch(s){console.error(s)}this.grid.add(t),r.hide()})}}class C{constructor(n){this.albumId=n,this.lastPage=null,this.currentPage=0}async start(){return this.currentPage=0,await this.next()}hasNextPage(){return this.lastPage==null||this.currentPage<this.lastPage}async next(){return this.hasNextPage()?await this._fetchPage(this.currentPage+1):[]}async _fetchPage(n=1){if(this.albumId==null||l.isLoading(this.albumId))return[];try{const t=await l.request(`/api/albums/${this.albumId}/photos?page=${n}`,"GET",null,this.albumId);return this.currentPage=t.meta.current_page,this.lastPage=t.meta.last_page,t.data}catch(t){console.error(t)}return[]}}
