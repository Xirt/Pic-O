import{S as m}from"./Selection-DBGP1SeL.js";import{A as o}from"./AppRequest-D0B9dxYA.js";import{G as h,a as p}from"./Grid-CdZKQaPg.js";import{S as b}from"./SelectionManager-BzuGZypI.js";import{g as c,c as d,p as f,o as l,r as y}from"./domHelpers-0caSGQTr.js";const u={searchQuery:"",direction:"ASC",order:"name",debounceTimer:null,debounceDelay:300,searchInput:document.getElementById("inp-search"),orderItems:document.querySelectorAll(".dropdown-item[data-order]"),directionItems:document.querySelectorAll(".dropdown-item[data-direction]"),init(a){this.callback=a,this.bindSearch(),this.bindOrdering(),this.bindDirection()},bindSearch(){this.searchInput.addEventListener("input",()=>{const a=this.searchInput.value.trim();clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.searchQuery=a,this.reload()},this.debounceDelay)})},bindOrdering(){this.orderItems.forEach(a=>{a.addEventListener("click",t=>{t.preventDefault();const e=a.dataset.order;e!==this.order&&(this.orderItems.forEach(s=>s.classList.remove("selected")),a.classList.add("selected"),this.order=e,this.reload())})})},bindDirection(){this.directionItems.forEach(a=>{a.addEventListener("click",t=>{t.preventDefault();const e=a.dataset.direction;e!==this.direction&&(this.directionItems.forEach(s=>s.classList.remove("selected")),this.direction=e,a.classList.add("selected"),this.reload())})})},async reload(){this.callback()}};document.addEventListener("DOMContentLoaded",async()=>{const a=document.getElementById("grid");new m(a);const t=new g;t.init();const e=document.getElementById("createAlbumForm");e.addEventListener("submit",async function(r){if(r.preventDefault(),!e.checkValidity()){e.reportValidity();return}try{await o.request(e.action,"POST",c(e),"albums"),await t.init()}catch(n){console.error(n)}d("offcanvas-create-album"),e.reset()});const s=document.getElementById("updateAlbumForm");s.addEventListener("submit",async function(r){r.preventDefault();try{const n=document.getElementById("albumId").value;await o.request(route("api.albums.update",{album:n}),"PATCH",c(s),"albums"),await t.init()}catch(n){console.error(n)}d("offcanvas-modify-album"),s.reset()}),new b({elements:{input:"dropdownInput",menu:"dropdownMenu",container:"search-dropdown-container",hiddenInput:"dropdownHidden"},apiUrl:route("api.albums.search"),renderItem:null})});class g{constructor(){u.init(()=>{this.init()}),this.grid=new h(this),this.loader=new w(u)}async init(){this.grid.clear(),await this.show()}async show(){const t=await this.loader.start();this._show(t)}async showMore(){if(this.loader.hasNextPage()){const t=await this.loader.next();this._show(t)}}async _show(t){const e=await Promise.all(t.map(async s=>{const r=await p.album(s);return r.querySelector(".btn-modify").addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.showModifyAlbum(r)}),r.querySelector(".btn-delete").addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.showRemovalconfirmation(r)}),r}));this.grid.add(e)}async showModifyAlbum(t){try{const e=route("api.albums.show",{album:t.getAttribute("data-id")}),s=await o.request(e,"GET");f(document.getElementById("updateAlbumForm"),s.data)}catch(e){console.error(e)}l("offcanvas-modify-album")}showRemovalconfirmation(t){const e=l("offcanvas-remove-album");let s=document.getElementById("btn-remove");y(s).addEventListener("click",()=>{try{const r=route("api.albums.destroy",{album:t.getAttribute("data-id")});o.request(r,"DELETE")}catch(r){console.log(r)}this.grid.remove(t),e.hide()})}}class w{constructor(t){this.filter=t,this.lastPage=null,this.currentPage=0}async start(){return this.currentPage=0,await this.next()}hasNextPage(){return this.lastPage==null||this.currentPage<this.lastPage}async next(){return this.hasNextPage()?this._fetchPage(this.currentPage+1):[]}async _fetchPage(t=1){if(o.isLoading("albums"))return[];try{const e=this.filter,s=`/api/albums/search?q=${encodeURIComponent(e.searchQuery)}&order=${encodeURIComponent(e.order)}&direction=${e.direction}&page=${t}`,r=await o.request(s,"GET",null,"albums");return this.currentPage=r.meta.current_page,this.lastPage=r.meta.last_page,r.data}catch(e){console.error(e)}return[]}}
