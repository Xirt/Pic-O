import{b as h}from"./domHelpers-BH3uQtD-.js";class a extends EventTarget{constructor(t){super(),this.container=t,this.picoView=document.getElementById("picoView"),this.picoViewInner=document.getElementById("picoViewInner"),this.closeBtn=document.getElementById("closeBtn"),this.slideshowBtn=document.getElementById("slideshowBtn"),this.prevBtn=document.getElementById("prevBtn"),this.nextBtn=document.getElementById("nextBtn"),this.toolbar=document.getElementById("toolbar"),this.spinner=document.getElementById("spinner"),this.gallery=Array.from(this.container.querySelectorAll("a.thumbnail")),this.currentIndex=0,this.currentWrapper=null,this.keysEnabled=!0,this.slideshowTimer=null,this.enabled=!0,this.initEvents()}initEvents(){this.container.addEventListener("click",s=>{const e=s.target.closest("a");if(e&&this.gallery.includes(e)&&this.enabled){s.preventDefault();const i=this.gallery.indexOf(e);this.show(i)}}),this.slideshowBtn.addEventListener("click",()=>this.toggleSlideshow()),this.closeBtn.addEventListener("click",()=>this.close()),this.prevBtn.addEventListener("click",()=>this.prev()),this.nextBtn.addEventListener("click",()=>this.next()),this.toolbar.addEventListener("click",s=>{const e=s.target.closest(".action");e&&e.dataset.action&&this.dispatchEvent(new CustomEvent(e.dataset.action,{detail:{id:this.gallery[this.currentIndex].dataset.id,index:this.currentIndex}}))}),document.addEventListener("keydown",s=>{!this.keysEnabled||!this.picoView.classList.contains("show-bg")||(s.key==="Escape"&&this.close(),s.key==="ArrowLeft"&&this.currentIndex>0&&this.prev(),s.key==="ArrowRight"&&this.currentIndex<this.gallery.length-1&&this.next())});let t=0,n=0;this.picoView.addEventListener("touchstart",s=>{const e=s.changedTouches[0];t=e.screenX,n=e.screenY},{passive:!0}),this.picoView.addEventListener("touchend",s=>{const e=s.changedTouches[0],i=e.screenX-t,r=e.screenY-n;Math.abs(i)>Math.abs(r)?Math.abs(i)>50&&(i>0?this.prev():this.next()):r>50&&this.close()},{passive:!0})}enable(){this.enabled=!0}disable(){this.enabled=!1}refresh(){this.gallery=Array.from(this.container.querySelectorAll("a.thumbnail")),this.updateNavButtons()}reset(){this.close(),this.refresh()}show(t,n=null){const s=this.gallery[t];if(!s)return;const e=document.createElement("div");e.className="picoview-img-wrapper",e.classList.add(n?n==="next"?"next":"prev":"open");const i=document.createElement("img");i.src=s.href,e.appendChild(i);const r=this.currentWrapper;this.currentWrapper=e,this.currentIndex=t,this.picoViewInner.appendChild(e),this.spinner.classList.remove("d-none"),this.picoView.classList.remove("d-none"),this.picoView.classList.add("show-bg"),this.picoView.offsetHeight,i.onload=()=>{this.spinner.classList.add("d-none"),e.offsetHeight,requestAnimationFrame(()=>{n?(e.classList.remove("prev","next"),r?.classList.add(n==="next"?"prev":"next")):e.classList.remove("open"),r&&setTimeout(()=>r.remove(),5e3)})},h(!0),this.preloadAdjacent(t),this.updateNavButtons(),this.loadMore()}preloadAdjacent(t){const n=t>0?t-1:null,s=t<this.gallery.length-1?t+1:null;[n,s].forEach(e=>{if(e!==null){const i=new Image;i.src=this.gallery[e].href}})}updateNavButtons(){this.prevBtn.disabled=this.currentIndex===0,this.nextBtn.disabled=this.currentIndex===this.gallery.length-1}loadMore(){this.currentIndex===this.gallery.length-1&&this.dispatchEvent(new CustomEvent("photo.more",{}))}next(){this.currentIndex<this.gallery.length-1&&this.show(this.currentIndex+1,"next")}prev(){this.currentIndex>0&&this.show(this.currentIndex-1,"prev")}close(){this.picoView.classList.remove("show-bg"),h(!1),setTimeout(()=>{this.picoView.classList.add("d-none"),this.picoViewInner.innerHTML="",this.currentWrapper=null,this.stopSlideshow()},400)}enableKeys(){this.keysEnabled=!0}disableKeys(){this.keysEnabled=!1}startSlideshow(t=4e3){this.stopSlideshow(),this.slideshowBtn.classList.add("playing"),document.body.classList.add("slideshow-mode"),this.slideshowTimer=setInterval(()=>{this.currentIndex<this.gallery.length-1?this.next():this.stopSlideshow()},t)}stopSlideshow(){this.slideshowTimer&&(clearInterval(this.slideshowTimer),this.slideshowBtn.classList.remove("playing"),document.body.classList.remove("slideshow-mode"),this.slideshowTimer=null)}toggleSlideshow(t=3e3){this.slideshowTimer?this.stopSlideshow():this.startSlideshow(t)}}export{a as P};
