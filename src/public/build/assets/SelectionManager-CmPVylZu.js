import{A as d}from"./AppRequest--Uc4TjP3.js";class h{constructor({elements:t,apiUrl:n,renderItem:s}){["input","menu","container","hiddenInput"].forEach(i=>{this[i]=typeof t[i]=="string"?document.getElementById(t[i]):t[i]}),this.dropdown=new bootstrap.Dropdown(this.input),this.searchEndpoint=n,this.renderItem=s||this.defaultRenderItem,this.currentItems=[],this.selectedValue=null,this.lastQuery="",this.debounceTimer=null,this.activeIndex=-1,this.init()}init(){this.input.addEventListener("input",()=>this.onInput()),this.input.addEventListener("keydown",t=>this.handleKeyDown(t)),document.addEventListener("click",t=>{this.container.contains(t.target)||this.dropdown.hide()})}defaultRenderItem(t){const n=document.createElement("div"),s=document.createElement("b");if(s.textContent=t.name,n.appendChild(s),t.label){n.appendChild(document.createElement("br"));const i=document.createElement("span");i.style.fontSize="0.75em",i.textContent=t.label,n.appendChild(i)}return n}clearMenu(){this.menu.innerHTML="",this.currentItems=[],this.activeIndex=-1}populateMenu(t){if(this.clearMenu(),!t||t.length===0){const n=document.createElement("li");n.innerHTML='<span class="dropdown-item disabled">No results</span>',this.menu.appendChild(n);return}t.forEach((n,s)=>{console.log(n);const i=document.createElement("li"),r=this.renderItem(n);if(typeof r=="string")i.innerHTML=`<a class="dropdown-item h6" href="#" data-value="${n.id}">${r}</a>`;else if(r instanceof Node){const a=document.createElement("a");a.className="dropdown-item h6",a.href="#",a.appendChild(r),i.appendChild(a)}i.querySelector("a").addEventListener("click",a=>{a.preventDefault(),this.selectItem(s)}),this.menu.appendChild(i)}),this.dropdown.show(),this.currentItems=t}selectItem(t){const n=this.currentItems[t];n&&(this.input.value=n.label||n.name,this.hiddenInput.value=n.id,this.selectedValue=n.id,this.dropdown.hide(),this.clearMenu())}async fetchItems(t){if(!t||t.length<2)return this.clearMenu();try{const n=await d.request(`${this.searchEndpoint}?q=${encodeURIComponent(t)}`,"GET");this.populateMenu(n.data)}catch{console.error(e)}}updateActiveItem(t){const n=Array.from(this.menu.querySelectorAll(".dropdown-item:not(.disabled)"));n.length!==0&&(n.forEach(s=>s.classList.remove("active")),t==="down"?this.activeIndex=(this.activeIndex+1)%n.length:t==="up"&&(this.activeIndex=(this.activeIndex-1+n.length)%n.length),n[this.activeIndex].classList.add("active"))}handleKeyDown(t){if(this.menu.children.length!==0)switch(t.key){case"ArrowDown":t.preventDefault(),this.updateActiveItem("down"),this.dropdown.show();break;case"ArrowUp":t.preventDefault(),this.updateActiveItem("up"),this.dropdown.show();break;case"Enter":t.preventDefault(),this.activeIndex>=0&&this.selectItem(this.activeIndex);break;case"Escape":this.dropdown.hide();break}}onInput(){const t=this.input.value.trim();t!==this.lastQuery&&(this.lastQuery=t,clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.fetchItems(t)},300))}}export{h as S};
