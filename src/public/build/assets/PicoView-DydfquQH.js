import{b as c,d,t as l}from"./domHelpers-DvNThchU.js";import{P as m}from"./Grid-DsGZyy7Q.js";class p extends EventTarget{constructor(t,e="a.thumbnail"){if(super(),!(t instanceof HTMLElement))throw new Error("PicoView: container must be a DOM element.");this.container=t,this.selector=e,this.init(),this.activate(),this.reset(),this.enable(),this.refresh()}init(){this.picoView=document.getElementById("picoView"),this.stage=this.picoView.querySelector(".picoview-stage"),this.indicator=this.picoView.querySelector(".spinner-overlay")}activate(){this.container.addEventListener("click",i=>{const n=i.target.closest("a");if(!n||!this.enabled)return;const r=this.items.findIndex(h=>h.id&&h.id===n.dataset.id);r!==-1&&(i.preventDefault(),this.show(r))}),document.addEventListener("keydown",i=>{if(this.picoView.classList.contains("show"))switch(i.key){case"ArrowLeft":this.prev();break;case"ArrowRight":this.next();break;case"Escape":this.close();break}}),document.getElementById("toolbar").addEventListener("click",i=>{const n=i.target.closest(".action");n&&n.dataset.action&&this.dispatchEvent(new CustomEvent(n.dataset.action,{detail:{id:this.items[this.currentIndex].id,index:this.currentIndex}}))}),document.getElementById("slideshowBtn").addEventListener("click",()=>{this.toggleSlideshow()}),document.getElementById("closeBtn").addEventListener("click",()=>{this.close()}),document.getElementById("prevBtn").addEventListener("click",()=>{this.prev()}),document.getElementById("nextBtn").addEventListener("click",()=>{this.next()})}refresh(t=null){Array.isArray(t)||(t=this.container.querySelectorAll(this.selector)),this.items=Array.from(t,e=>({href:e.getAttribute("href"),id:e.dataset.id||null}))}enable(){this.enabled=!0}disable(){this.enabled=!1}reset(t=null){this.slideshowTimer=null,this.currentImage=null,this.currentIndex=-1,this.items=[]}show(t){const e=this.currentImage;if(t<0||t>=this.items.length){console.warn("PicoView: Index out of bounds.");return}this.currentImage=this._getImage(t);const s=this._getTransition(t);this._setTransition(this.currentImage,s),this._setTransition(e,s),this.currentIndex=t,c(!0),this._preloadAdjacent(t),this._show(e)}_toggleLoadingIndicator(t){this.indicator.classList.toggle("show",t)}_show(t){this.picoView.classList.remove("d-none"),this.picoView.offsetHeight,this.picoView.classList.add("show");const e=()=>{this.dispatchEvent(new CustomEvent("photo.shown",{detail:{id:this.items[this.currentIndex].id,index:this.currentIndex}})),this._toggleLoadingIndicator(!1),this.currentImage.classList.add("show"),t?.classList.remove("show"),t?.classList.add("bye"),this.oldImage?._panzoom?.destroy()},s=this.currentImage.querySelector("img");s.complete&&s.naturalHeight!==0?e():(this._toggleLoadingIndicator(!0),s.onload=e)}_setTransition(t,e){t?.classList.remove("transition-open","transition-left","transition-right"),t?.classList.add(e)}_getTransition(t){return this.currentIndex==-1?"transition-open":t<this.currentIndex?"transition-left":"transition-right"}_getImage(t){const e=document.createElement("div");e.classList.add("picoview-img-wrapper","overflow-hidden");const s=document.createElement("img");return s.src=this.items[t].href,e.appendChild(s),this.stage.appendChild(e),setTimeout(()=>{this._activateImage(s,e)},400),e}_activateImage(t,e){let s=0,a=0,o=!1;t._panzoom=m(t,{maxScale:5,minScale:1,cursor:"auto",contain:"outside"}),e.addEventListener("wheel",i=>{t._panzoom.zoomWithWheel(i)}),e.addEventListener("touchstart",i=>{s=i.changedTouches[0].screenX}),t.addEventListener("panzoomzoom",i=>{const{scale:n}=i.detail;Math.abs(n-1)<.01&&t._panzoom.zoom(1)}),e.addEventListener("touchend",i=>{a=i.changedTouches[0].screenX;const n=a-s,r=Math.abs(t._panzoom.getScale()-1)<.01;!o&&r&&Math.abs(n)>50&&(o=!0,n>0?this.prev():this.next(),setTimeout(()=>o=!1,300))})}_preloadAdjacent(t){t<this.items.length-1&&this._preloadImage(this.items[t+1].href),t>0&&this._preloadImage(this.items[t-1].href),t===this.items.length-1&&this.dispatchEvent(new CustomEvent("photo.more",{}))}_preloadImage(t){const e=new Image;e.src=t}next(){this.currentIndex<this.items.length-1&&this.show(this.currentIndex+1)}prev(){this.currentIndex>0&&this.show(this.currentIndex-1)}close(){this.picoView.classList.remove("show"),c(!1),this.stopSlideshow(),setTimeout(()=>{this.picoView.classList.add("d-none"),this.currentImage.remove(),this.currentIndex=-1},400)}startSlideshow(t=4e3){d("slideshow-mode",!0),this.slideshowTimer=setInterval(()=>{this.currentIndex<this.items.length-1?this.next():this.stopSlideshow()},t),l("Slideshow started")}stopSlideshow(){this.slideshowTimer&&(d("slideshow-mode",!1),clearInterval(this.slideshowTimer),this.slideshowTimer=null,l("Slideshow stopped"))}toggleSlideshow(t=4e3){this.slideshowTimer?this.stopSlideshow():this.startSlideshow(t)}}export{p as P};
