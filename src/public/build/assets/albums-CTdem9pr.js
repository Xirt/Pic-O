import{A as d,g as u,c as m,p as y,o as h,r as b,t as p}from"./domHelpers-Bl1jAPjX.js";import{G as g,a as E}from"./Grid-DRax1VmO.js";import{S as v,a as w}from"./SelectionManager-CMotajaX.js";const f={searchQuery:"",searchType:"",direction:"ASC",order:"name",debounceTimer:null,debounceDelay:300,queryEl:document.getElementById("inp-search"),typeEl:document.getElementById("sel-type"),orderItems:document.querySelectorAll(".dropdown-item[data-order]"),directionItems:document.querySelectorAll(".dropdown-item[data-direction]"),init(r){this.callback=r,this.bindType(),this.bindSearch(),this.bindOrdering(),this.bindDirection()},bindType(){this.typeEl.addEventListener("change",()=>{const r=this.typeEl.value;this.searchType=r,this.reload()})},bindSearch(){this.queryEl.addEventListener("input",()=>{const r=this.queryEl.value.trim();clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.searchQuery=r,this.reload()},this.debounceDelay)})},bindOrdering(){this.orderItems.forEach(r=>{r.classList.contains("selected")&&(this.order=r.dataset.order),r.addEventListener("click",e=>{e.preventDefault();const t=r.dataset.order;t!==this.order&&(this.orderItems.forEach(s=>s.classList.remove("selected")),r.classList.add("selected"),this.order=t,this.reload())})})},bindDirection(){this.directionItems.forEach(r=>{r.classList.contains("selected")&&(this.direction=r.dataset.direction),r.addEventListener("click",e=>{e.preventDefault();const t=r.dataset.direction;t!==this.direction&&(this.directionItems.forEach(s=>s.classList.remove("selected")),this.direction=t,r.classList.add("selected"),this.reload())})})},async reload(){this.callback()}};document.addEventListener("DOMContentLoaded",async()=>{const r=document.getElementById("grid");new v(r);const e=new A;e.init(),document.getElementById("modifyButton").addEventListener("click",async c=>{const o=document.querySelector(".card.selected");e.showModifyAlbum(o),c.preventDefault()}),document.getElementById("deleteButton").addEventListener("click",async c=>{const o=document.querySelectorAll(".card.selected");e.showRemovalconfirmation(o),c.preventDefault()});const a=document.getElementById("createAlbumFromFolderForm");a.addEventListener("submit",async function(c){if(c.preventDefault(),!a.checkValidity())return a.reportValidity();a.querySelectorAll("button").forEach(o=>o.disabled=!0);try{await d.request(a.action,"POST",u(a),"albums"),await e.init()}catch(o){console.error(o)}m("offcanvas-create-album-from-folder"),a.querySelectorAll("button").forEach(o=>o.disabled=!1)}),document.getElementById("offcanvas-create-album-from-folder").addEventListener("show.bs.offcanvas",function(){a.reset()});const n=document.getElementById("updateAlbumForm");n.addEventListener("submit",async function(c){c.preventDefault(),n.querySelectorAll("button").forEach(o=>o.disabled=!0);try{const o=document.getElementById("albumId").value;await d.request(route("api.albums.update",{album:o}),"PATCH",u(n),"albums"),await e.init()}catch(o){console.error(o)}m("offcanvasUpdateAlbum"),n.querySelectorAll("button").forEach(o=>o.disabled=!1)});const i=new w({container:"createAlbumFromFolder",apiUrl:route("api.folders.search")});a.reset(),i.updateList()});class A{constructor(){f.init(()=>{this.init()}),this.grid=new g(this),this.loader=new L(f)}async init(){this.grid.clear(),await this.show()}async show(){const e=await this.loader.start();this._show(e)}async showMore(){if(this.loader.hasNextPage()){const e=await this.loader.next();this._show(e)}}async _show(e){const t=await Promise.all(e.map(async s=>{const a=await E.album(s);return a.querySelector(".btn-modify").addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.showModifyAlbum(a)}),a.querySelector(".btn-delete").addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.showRemovalconfirmation(a)}),a}));this.grid.add(t)}async showModifyAlbum(e){try{const t=route("api.albums.show",{album:e.getAttribute("data-id")}),s=await d.request(t,"GET");y(document.getElementById("updateAlbumForm"),s.data)}catch(t){console.error(t)}h("offcanvasUpdateAlbum")}showRemovalconfirmation(e){let t=[e];e instanceof NodeList&&(t=Array.from(e));const s=document.getElementById("delCount");s.textContent=t.length;const a=h("offcanvasRemoveAlbum");let l=document.getElementById("btn-remove");b(l).addEventListener("click",()=>{try{for(const n of t){const i=route("api.albums.destroy",{album:n.getAttribute("data-id")});d.request(i,"DELETE"),p("Album(s) deleted"),this.grid.remove(n)}}catch(n){console.log(n)}a.hide()})}}class L{constructor(e){this.filter=e,this.lastPage=null,this.currentPage=0}async start(){return this.currentPage=0,await this.next()}hasNextPage(){return this.lastPage==null||this.currentPage<this.lastPage}async next(){return this.hasNextPage()?this._fetchPage(this.currentPage+1):[]}async _fetchPage(e=1){if(d.isLoading("albums"))return[];try{const t=this.filter,s=`/api/albums/search?q=${encodeURIComponent(t.searchQuery)}&type=${encodeURIComponent(t.searchType)}&order=${encodeURIComponent(t.order)}&direction=${t.direction}&page=${e}`,a=await d.request(s,"GET",null,"albums");return this.currentPage=a.meta.current_page,this.lastPage=a.meta.last_page,a.data}catch(t){console.error(t)}return[]}}
