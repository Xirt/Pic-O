import{b as E}from"./domHelpers-0caSGQTr.js";import{A as L}from"./AppRequest-BdPYhK6t.js";const R=(function(a){const t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],o=e=>{let n=0;for(let r=0;r<e.length;r++){const s=e[r],l=t.indexOf(s);n=n*83+l}return n},c=(e,n)=>{var r="";for(let s=1;s<=n;s++){let l=Math.floor(e)/Math.pow(83,n-s)%83;r+=t[Math.floor(l)]}return r},d=e=>{let n=e/255;return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)},i=e=>{let n=Math.max(0,Math.min(1,e));return n<=.0031308?Math.round(n*12.92*255+.5):Math.round((1.055*Math.pow(n,.4166666666666667)-.055)*255+.5)},v=e=>e<0?-1:1,f=(e,n)=>v(e)*Math.pow(Math.abs(e),n),C=e=>{if(!e||e.length<6)throw new Error("The blurhash string must be at least 6 characters");const n=o(e[0]),r=Math.floor(n/9)+1,s=n%9+1;if(e.length!==4+2*s*r)throw new Error(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*s*r}`)},B=e=>{const n=e>>16,r=e>>8&255,s=e&255;return[d(n),d(r),d(s)]},x=(e,n)=>{const r=Math.floor(e/361),s=Math.floor(e/19)%19,l=e%19;return[f((r-9)/9,2)*n,f((s-9)/9,2)*n,f((l-9)/9,2)*n]},G=(e,n,r,s)=>{let l=0,p=0,h=0;const M=n*4;for(let y=0;y<n;y++)for(let b=0;b<r;b++){const u=s(y,b);l+=u*d(e[4*y+0+b*M]),p+=u*d(e[4*y+1+b*M]),h+=u*d(e[4*y+2+b*M])}let w=1/(n*r);return[l*w,p*w,h*w]},W=e=>{const n=i(e[0]),r=i(e[1]),s=i(e[2]);return(n<<16)+(r<<8)+s},O=(e,n)=>{let r=Math.floor(Math.max(0,Math.min(18,Math.floor(f(e[0]/n,.5)*9+9.5)))),s=Math.floor(Math.max(0,Math.min(18,Math.floor(f(e[1]/n,.5)*9+9.5)))),l=Math.floor(Math.max(0,Math.min(18,Math.floor(f(e[2]/n,.5)*9+9.5))));return r*19*19+s*19+l};return a.decodePromise=(e,n,r,s=1)=>new Promise((l,p)=>{l(a.decode(e,n,r,s))}),a.decode=(e,n,r,s=1)=>{C(e),s=s|1;const l=o(e[0]),p=Math.floor(l/9)+1,h=l%9+1,w=(o(e[1])+1)/166,y=new Array(h*p);for(let m=0;m<y.length;m++)if(m===0){const g=o(e.substring(2,6));y[m]=B(g)}else{const g=o(e.substring(4+m*2,6+m*2));y[m]=x(g,w*s)}const b=n*4,u=new Uint8ClampedArray(b*r);for(let m=0;m<r;m++)for(let g=0;g<n;g++){let N=0,I=0,P=0;for(let k=0;k<p;k++)for(let A=0;A<h;A++){const D=Math.cos(Math.PI*g*A/n)*Math.cos(Math.PI*m*k/r);let q=y[A+k*h];N+=q[0]*D,I+=q[1]*D,P+=q[2]*D}let _=i(N),F=i(I),H=i(P);u[4*g+0+m*b]=_,u[4*g+1+m*b]=F,u[4*g+2+m*b]=H,u[4*g+3+m*b]=255}return u},a.encodePromise=(e,n,r,s,l)=>new Promise((p,h)=>{p(a.encode(e,n,r,s,l))}),a.encode=(e,n,r,s,l)=>{if(s<1||s>9||l<1||l>9)throw new Error("BlurHash must have between 1 and 9 components");if(n*r*4!==e.length)throw new Error("Width and height must match the pixels array");let p=[];for(let u=0;u<l;u++)for(let m=0;m<s;m++){const g=m==0&&u==0?1:2,N=G(e,n,r,(I,P)=>g*Math.cos(Math.PI*m*I/n)*Math.cos(Math.PI*u*P/r));p.push(N)}const h=p[0],M=p.slice(1);let w="",y=s-1+(l-1)*9;w+=c(y,1);let b;if(M.length>0){let u=Math.max(...M.map(g=>Math.max(...g))),m=Math.floor(Math.max(0,Math.min(82,Math.floor(u*166-.5))));b=(m+1)/166,w+=c(m,1)}else b=1,w+=c(0,1);return w+=c(W(h),4),M.forEach(u=>{w+=c(O(u,b),2)}),w},a.getImageData=e=>{const n=e.width,r=e.height,s=document.createElement("canvas"),l=s.getContext("2d");return s.width=n,s.height=r,l.width=n,l.height=r,l.drawImage(e,0,0),l.getImageData(0,0,n,r).data},a.drawImageDataOnNewCanvas=(e,n,r)=>{const s=document.createElement("canvas"),l=s.getContext("2d");return s.width=n,s.height=r,l.width=n,l.height=r,l.putImageData(new ImageData(e,n,r),0,0),s},a.getImageDataAsImageWithOnloadPromise=(e,n,r)=>new Promise((s,l)=>{a.getImageDataAsImage(e,n,r,(p,h)=>{s(h)})}),a.getImageDataAsImage=(e,n,r,s)=>{const p=a.drawImageDataOnNewCanvas(e,n,r).toDataURL(),h=new Image(n,r);return h.onload=M=>s(M,h),h.width=n,h.height=r,h.src=p,h},a})({});class z{constructor(t,o="grid",c=".grid-item"){this.sleep=d=>new Promise(i=>setTimeout(i,d)),this.container=typeof o=="string"?document.getElementById(o):o,this.itemSelector=c,this.manager=t,this.rendering=!1,this.items=[],this.masonry=new Masonry(this.container,{itemSelector:c,columnWidth:".grid-sizer",transitionDuration:"0.4s",percentPosition:!0})}add(t,o=!0){const c=Array.isArray(t)?t:[t];this.items=this.items.concat(c),this.render(o)}async render(t){if(!this.rendering){for(this.rendering=!0;this.items.length;)this._append(this.items.shift()),this.container.dispatchEvent(new CustomEvent("grid.render.added",{})),await this.sleep(25);t&&this.setupObserver(),this.rendering=!1,this.container.dispatchEvent(new CustomEvent("grid.render.done",{}))}}_append(t){const o=document.createElement("div");o.className="col-sm-6 col-lg-4 grid-item overflow-hidden",o.appendChild(t),this.container.appendChild(o),this.masonry.appended(o),this.container.dispatchEvent(new CustomEvent("grid.refresh",{detail:{item:t}}))}remove(t){this.masonry.remove(t.parentElement),this.masonry.layout()}clear(){this.masonry.remove(this.container.children),this.masonry.layout(),this.items=[]}setupObserver(){const t=this.container.querySelectorAll(this.masonry.options.itemSelector);if(!t.length)return;new IntersectionObserver(async(c,d)=>{for(const i of c)i.isIntersecting&&!L.isLoading()&&(d.disconnect(),await this.manager.showMore())},{rootMargin:"200px"}).observe(t[t.length-1])}}const S={folder(a){const t=document.createElement("div");t.className="card clickable p-0 m-1";const o=document.createElement("div");o.className="card-body text-primary position-relative d-inline-block align-items-center text-center p-4",t.appendChild(o);const c=document.createElement("img");c.className="img-fluid",c.src="images/folder.png",o.appendChild(c);const d=document.createElement("img");d.className="position-absolute folder-thumbnail w-75",d.src=`folders/${a.id}/thumbnail`,o.appendChild(d);const i=document.createElement("div");return i.className="card-footer text-center text-truncate",i.textContent=a.name,i.title=a.name,t.appendChild(i),t},photoFolder(a,t){const o=document.createElement("a");o.href=a.path_full,o.setAttribute("data-id",a.id),o.setAttribute("data-type","image"),o.className="card selectable clickable thumbnail p-0 m-1";const c=document.createElement("div");c.className="card-img-container text-primary position-relative d-inline-block align-items-center text-center p-4",o.appendChild(c);const d=document.createElement("img");d.className="card-img-top",d.src=a.path_thumb,c.appendChild(d);const i=E("check-circle-fill","text-light opacity-75 position-absolute top-50 start-50 translate-middle fs-1 pb-4");o.appendChild(i);const v=document.createElement("div");return v.className="card-footer text-center text-truncate",v.textContent=a.filename,v.title=a.filename,o.appendChild(v),o},async photo(a,t=!0){const o=Math.min(250/a.width,1),c=Math.round(a.width*o),d=Math.round(a.height*o),i=document.createElement("a");i.id=`card-${a.id}`,i.href=a.path_full,i.setAttribute("data-id",a.id),i.setAttribute("data-type","image"),i.style.cssText=`width: 100%; aspect-ratio: ${c} / ${d};`,i.className="clickable selectable thumbnail position-relative d-block align-items-center text-center m-1 mb-0";const v=E("check-circle-fill","text-light opacity-75 position-absolute top-50 start-50 translate-middle fs-1");i.appendChild(v);const f=document.createElement("div");f.className="img-container text-primary position-relative d-inline-block align-items-center text-center";const C=await this._createBlurHash(a,c,d);C.className="d-block w-100 h-100 m-0 blurhash",C.removeAttribute("height"),C.removeAttribute("width"),i.appendChild(C);const B=document.createElement("img");B.className="d-block w-100 h-100 opacity-0 m-0",B.src=a.path_thumb,i.appendChild(B);const x=document.createElement("div");return x.className="d-block card-img-overlay bg-dark text-light fw-semibold quick-actions top p-1 me-1",i.appendChild(x),x.appendChild(this.createInfoButton(i)),x.appendChild(this.createDownloadButton(i)),t&&(x.appendChild(this.createCoverButton(i)),x.appendChild(this.createDeleteButton(i))),B.onload=()=>{B.classList.remove("opacity-0"),C.classList.add("opacity-0"),setTimeout(()=>i.removeChild(C),1e3)},i},async album(a){const t=document.createElement("a");if(t.className="card selectable position-relative ratio ratio-4x3 p-0 clickable",t.href=route("albums.show",{id:a.id}),t.setAttribute("data-id",a.id),a.cover){const v=await this._createBlurHash(a.cover);v.className="d-block position-absolute object-fit-cover w-100 h-100",t.appendChild(v);const f=document.createElement("img");f.className="d-block object-fit-cover",f.src=`photos/${a.cover.id}/thumbnail`,f.loading="lazy",t.appendChild(f)}const o=E("check-circle-fill","text-light opacity-75 h-auto w-auto position-absolute top-50 start-50 translate-middle fs-1");t.appendChild(o);const c=document.createElement("div");c.className="card-img-overlay bottom badge rounded-pill bg-secondary text-light fw-bold px-2 py-1 m-1",c.textContent=a.photos,t.appendChild(c);const d=document.createElement("div");d.className="card-img-overlay top bg-dark text-light fw-semibold p-2",d.textContent=a.name,t.appendChild(d);const i=document.createElement("div");return i.className="d-block quick-actions p-1",t.appendChild(i),i.appendChild(this.createModifyButton(t)),i.appendChild(this.createDeleteButton(t)),t},separator(a){const t=document.createElement("h5");return t.className="text-dark-emphasis p-2 pb-1 mt-4 fw-semibold border-bottom",t.innerText=a,t},createInfoButton(a){const t=document.createElement("button");t.className="btn btn-light btn-sm me-1 btn-info";const o=E("info-circle-fill","text-secondary");return t.appendChild(o),t},createDownloadButton(a){const t=document.createElement("button");t.className="btn btn-light btn-sm me-1 btn-download";const o=E("download","text-secondary");return t.appendChild(o),t},createCoverButton(a){const t=document.createElement("button");t.className="btn btn-light btn-sm me-1 btn-cover no-share";const o=E("star-fill","text-secondary");return t.appendChild(o),t},createModifyButton(a){const t=document.createElement("button");t.className="btn btn-light btn-sm me-1 btn-modify no-share";const o=E("pencil-fill","text-secondary");return t.appendChild(o),t},createDeleteButton(a){const t=document.createElement("button");t.className="btn btn-light btn-sm btn-delete no-share";const o=E("trash3","text-secondary");return t.appendChild(o),t},async _createBlurHash(a,t=250,o=250){let c=a.blurhash;return c=typeof c=="string"&&c.length>=6?c:"UOOGF~WB~qWB~qWB~qWB~qWB~qWB",await R.getImageDataAsImageWithOnloadPromise(R.decode(c,t,o),t,o)}};export{z as G,S as a};
