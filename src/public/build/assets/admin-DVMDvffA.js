import{A as m,t as v,o as I,r as L}from"./domHelpers-Bl1jAPjX.js";const h=(function(){const f=document.querySelector(".progress-container");let c={};const d={};let l=null,e=!1,t=!1,s=null;function o(){f.querySelectorAll(".job-progress").forEach(r=>{const u=r.dataset.jobType;u&&(d[u]={jobWrapper:r,countEl:r.querySelector(".job-count"),upArrow:r.querySelector(".arrow-up"),downArrow:r.querySelector(".arrow-down")},c[u]=0)})}async function a(){if(!t){t=!0;try{const n=await m.request(route("api.jobs.count"),"GET",null,null,!1),r={};for(const u of n)r[u.type]=u.count;i(r,c),c=r}catch(n){console.log(n)}t=!1}}function i(n){let r=!1;for(const u in d){const{jobWrapper:q,countEl:b,upArrow:p,downArrow:E}=d[u],y=n[u]||0,w=c[u]||0;b.textContent=y,w<y&&(p.classList.add("show"),setTimeout(()=>{p.classList.remove("show")},500)),w>y&&(E.classList.add("show"),setTimeout(()=>{E.classList.remove("show")},500)),r=y==0?r:!0}f.classList.toggle("visible",r),s&&s(r)}return{start:function(n){e||(o(),e=!0,l=setInterval(a,1e3),s=n||null,a())},stop:function(){if(e){clearInterval(l),l=null,e=!1;for(const n in maxCounts)maxCounts[n]=0;i({})}},isRunning:function(){return e}}})();document.addEventListener("DOMContentLoaded",()=>{let g;const f=document.getElementById("scanButton");f.addEventListener("click",async e=>{e.preventDefault();try{const t=await m.request(route("api.jobs.dispatch"),"POST",{type:"TraverseFolderJob"});v("Scan requested")}catch(t){console.log(t)}}),h.start(e=>{f.disabled=e});const c=document.getElementById("settingsForm");c.addEventListener("submit",async e=>{e.preventDefault();try{const t=new FormData(c),s=Object.fromEntries(t.entries()),o=await m.request(c.action,"POST",s);l(c.querySelector(".form-message"),o.message,!0)}catch(t){const s=t?.response?.message||t?.message||"An unknown error occurred.";l(c.querySelector(".form-message"),s,!1)}});const d=document.getElementById("createForm");d.addEventListener("submit",async e=>{e.preventDefault();try{const t=new FormData(d),s=Object.fromEntries(t.entries()),o=await m.request(d.action,"POST",s);l(document.getElementById("createFormMessage"),o.message,!0),setTimeout(()=>{window.location.href=window.location.href},1e3)}catch(t){const s=t?.response?.message||t?.message||"An unknown error occurred.";l(document.getElementById("createFormMessage"),s,!1)}}),document.querySelectorAll('button[data-bs-target="#offcanvas-modify-user"]').forEach(e=>{e.addEventListener("click",async function(){const t=this.getAttribute("data-user-id");try{const o=(await m.request(`/api/users/${t}`,"GET")).data;document.getElementById("modifyUserId").value=o.id,document.getElementById("modifyUserName").value=o.name,document.getElementById("modifyUserEmail").value=o.email,document.getElementById("modifyUserRole").value=o.role;const a=document.getElementById("offcanvas-modify-user");bootstrap.Offcanvas.getOrCreateInstance(a).show()}catch(s){alert("Failed to load user data: "+s.message)}})}),document.querySelectorAll("button.remove-user").forEach(e=>{e.addEventListener("click",function(){const t=this.getAttribute("data-user-id"),s=I("offcanvasRemoveUser");let o=document.getElementById("userRemovalBtn");L(o).addEventListener("click",async()=>{try{const a=route("api.users.destroy",{user:t}),i=await m.request(a,"DELETE");document.querySelector(`tr[data-user-id="${t}"]`)?.remove(),v("User deleted")}catch(a){a.message&&v(a.message)}s.hide()})})}),document.getElementById("modifyForm").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("modifyUserId").value,s=this,o=`/api/users/${t}`,a={name:s.name.value,email:s.email.value,role:s.role.value};document.getElementById("modifyFormMessage");try{const i=await m.request(o,"PUT",a);location.reload()}catch(i){const n=i?.response?.message||i?.message||"An unknown error occurred.";l(document.getElementById("modifyFormMessage"),n,!1)}});function l(e,t,s=!0){e.classList.add("visible"),e.classList.toggle("alert-success",s),e.classList.toggle("alert-warning",!s),e.textContent=t,g&&clearTimeout(g),g=setTimeout(()=>{e.classList.remove("visible")},3e3)}});
