import{A as d}from"./AppRequest-B2BOAsCr.js";const b=(function(){const f=document.querySelector(".progress-container");let a={};const l={};let u=null,e=!1,t=!1,s=null;function r(){f.querySelectorAll(".job-progress").forEach(o=>{const c=o.dataset.jobType;c&&(l[c]={jobWrapper:o,countEl:o.querySelector(".job-count"),upArrow:o.querySelector(".arrow-up"),downArrow:o.querySelector(".arrow-down")},a[c]=0)})}async function m(){if(!t){t=!0;try{const n=await d.request(route("api.jobs.count"),"GET",null,null,!1),o={};for(const c of n)o[c.type]=c.count;i(o,a),a=o}catch(n){console.log(n)}t=!1}}function i(n){let o=!1;for(const c in l){const{jobWrapper:I,countEl:w,upArrow:p,downArrow:v}=l[c],y=n[c]||0,E=a[c]||0;w.textContent=y,E<y&&(p.classList.add("show"),setTimeout(()=>{p.classList.remove("show")},500)),E>y&&(v.classList.add("show"),setTimeout(()=>{v.classList.remove("show")},500)),o=y==0?o:!0}f.classList.toggle("visible",o),s&&s(o)}return{start:function(n){e||(r(),e=!0,u=setInterval(m,1e3),s=n||null,m())},stop:function(){if(e){clearInterval(u),u=null,e=!1;for(const n in maxCounts)maxCounts[n]=0;i({})}},isRunning:function(){return e}}})();document.addEventListener("DOMContentLoaded",()=>{let g;const f=document.getElementById("scanButton");f.addEventListener("click",async e=>{e.preventDefault();try{const t=await d.request(route("api.jobs.dispatch"),"POST",{type:"TraverseFolderJob"});toast("Scan requested")}catch(t){console.log(t)}}),b.start(e=>{f.disabled=e});const a=document.getElementById("settingsForm");a.addEventListener("submit",async e=>{e.preventDefault();try{const t=new FormData(a),s=Object.fromEntries(t.entries()),r=await d.request(a.action,"POST",s);u(a.querySelector(".form-message"),r.message,!0)}catch(t){const s=t?.response?.message||t?.message||"An unknown error occurred.";u(a.querySelector(".form-message"),s,!1)}});const l=document.getElementById("createForm");l.addEventListener("submit",async e=>{e.preventDefault();try{const t=new FormData(l),s=Object.fromEntries(t.entries()),r=await d.request(l.action,"POST",s);u(document.getElementById("createFormMessage"),r.message,!0),setTimeout(()=>{window.location.href=window.location.href},1e3)}catch(t){const s=t?.response?.message||t?.message||"An unknown error occurred.";u(document.getElementById("createFormMessage"),s,!1)}}),document.querySelectorAll('button[data-bs-target="#offcanvas-modify-user"]').forEach(e=>{e.addEventListener("click",async function(){const t=this.getAttribute("data-user-id");try{const r=(await d.request(`/api/users/${t}`,"GET")).data;document.getElementById("modifyUserId").value=r.id,document.getElementById("modifyUserName").value=r.name,document.getElementById("modifyUserEmail").value=r.email,document.getElementById("modifyUserRole").value=r.role;const m=document.getElementById("offcanvas-modify-user");bootstrap.Offcanvas.getOrCreateInstance(m).show()}catch(s){alert("Failed to load user data: "+s.message)}})}),document.getElementById("modifyForm").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("modifyUserId").value,s=this,r=`/api/users/${t}`,m={name:s.name.value,email:s.email.value,role:s.role.value};document.getElementById("modifyFormMessage");try{const i=await d.request(r,"PUT",m);location.reload()}catch(i){const n=i?.response?.message||i?.message||"An unknown error occurred.";u(document.getElementById("modifyFormMessage"),n,!1)}});function u(e,t,s=!0){e.classList.add("visible"),e.classList.toggle("alert-success",s),e.classList.toggle("alert-warning",!s),e.textContent=t,g&&clearTimeout(g),g=setTimeout(()=>{e.classList.remove("visible")},3e3)}});
