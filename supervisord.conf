[supervisord]
nodaemon=true
stopasgroup=true
killasgroup=true

# -------------------------------------------------------------------
# PHP-FPM
# -------------------------------------------------------------------
[program:php-fpm]
command=docker-php-entrypoint php-fpm
stopsignal=QUIT
stopwaitsecs=10
autostart=true
autorestart=true
priority=5

# -------------------------------------------------------------------
# Nginx
# -------------------------------------------------------------------
[program:nginx]
command=nginx -g "daemon off;"
stopsignal=QUIT
stopwaitsecs=10
autostart=true
autorestart=true
priority=10

# -------------------------------------------------------------------
# Laravel queue workers - folders
# -------------------------------------------------------------------
[program:laravel-worker-folders]
command=php artisan queue:work --queue=folders --sleep=1 --tries=3 --timeout=600
user=www-data
directory=/var/www
autostart=true
autorestart=true
numprocs=2
process_name=%(program_name)s_%(process_num)02d
priority=15

# -------------------------------------------------------------------
# Laravel queue workers - photos
# -------------------------------------------------------------------
[program:laravel-worker-photos]
command=php artisan queue:work --queue=photos --sleep=5 --tries=3 --timeout=30
user=www-data
directory=/var/www
autostart=true
autorestart=true
numprocs=4
process_name=%(program_name)s_%(process_num)02d
priority=15

# -------------------------------------------------------------------
# Cron for Laravel scheduler
# -------------------------------------------------------------------
[program:cron]
command=cron -f
autostart=true
autorestart=true
priority=20
stdout_logfile=/var/log/cron.log
stderr_logfile=/var/log/cron.error.log
